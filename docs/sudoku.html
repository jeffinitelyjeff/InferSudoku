<!DOCTYPE html>  <html> <head>   <title>sudoku.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="domutil.html">                 domutil.coffee               </a>                                           <a class="source" href="grid.html">                 grid.coffee               </a>                                           <a class="source" href="settings.html">                 settings.coffee               </a>                                           <a class="source" href="solver.html">                 solver.coffee               </a>                                           <a class="source" href="sudoku.html">                 sudoku.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sudoku.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Sudoku.coffee is a sudoku solver created by Jeff Ruberg for a project in
COMP352 - Topics in Artificial Intelligence at Wesleyan University. The solver
uses human-level inference to solve a sudoku puzzle like a human, particularly
I, would. To this effect it uses a variety of strategies--some of which act
purely to fill in cells if possible, some of which act purely to refine
information about possible cell values, and some of which lie somewhere in
between. The goal of the project was to create a solver which imitated the
processes I would use to solve a sudoku, and, ideally, to replicate the order
of actions that I would take.</p>

<p>It will be helpful to define some terminology that will be used abundantly
throughout the code and documentation.</p>

<ul>
<li><strong>grid</strong> The Sudoku board.</li>
<li><strong>cell</strong> The smallest division of the grid; there are 81 cells, arranged in
       rows of 9 by 9.</li>
<li><strong>value</strong> A number in the range [1,9], and represents an item that can be
        used to fill in a cell.</li>
<li><strong>possible value</strong> A <em>possible value</em> for a particular cell is a value which
                 can be placed in the cell without contradicting other
                 information we know about the grid at the time. Note:
                 this definition is very subjective, and very dependent on
                 "what we know at the time"; in the end, only one value is
                 really "possible" for each cell. We will try to avoid
                 using the term "possible value" without specifying the
                 context of "possible."</li>
<li><strong>naively possible value</strong> A value which is possible in a particular cell
                         when considering only the other values which are
                         currently filled in on the grid.</li>
<li><strong>informed possible value</strong> A value which is possible in a particular cell
                          when considering the other values currently
                          filled in and all relevant information about
                          cell possibilites which we are storing.</li>
<li><strong>row</strong> A row of the Sudoku grid.</li>
<li><strong>col</strong> A column of the Sudoku grid.</li>
<li><strong>box</strong> One of the nine 3x3 subsections of the grid.</li>
<li><strong>group</strong> A row, col, or box.</li>
<li><strong>valid</strong> A group is <em>valid</em> if it contains one of each of the values 1-9</li>
<li><strong>solved</strong> A Sudoku grid is <em>solved</em> if all 9 rows, all 9 cols, and all 9
         boxes are valid.</li>
<li><strong>strategy</strong> A method/algorithm for filling in cell values or gathering
           information about possible cell values or restrictions with the
           goal of bringing the grid closer to a solved state.</li>
<li><strong>declarative strategy</strong> A strategy which aims to fill in values into cells
                       without attempting to update stored information
                       about cells' possibilities.</li>
<li><strong>knowledge refinement strategy</strong> A strategy which aims to update stored
                                information about cells' possibilites and
                                not fill in cell values.</li>
<li><strong>hybrid strategy</strong> A strategy which aims to fill in values into cells and
                  may update stored information about cells'
                  possibilities.</li>
<li><strong>cartesian coordinates</strong> A system of describing cell positions in the form
                        (c, r) where c is a col number and r is a row
                        number.</li>
<li><strong>box coordinates</strong> A system of describing cell positions in the form (bx,
                  by, sx, sy) where (bx, by) are the cartesian coordinates
                  of the box which the cell belongs to (note that boxes
                  are in the range [0-2]x[0-2]) and (sx, sy) are the
                  certesian coordinates of the cell within the box (also
                  in the range [0-2]x[0-2])</li>
<li><strong>base index</strong> An index into the sudoku grid internal representation, which
             is stored as a 81-element array.</li>
<li><strong>obvious value</strong> A cell value is <em>obvious</em> if the value is not yet filled
                in, but it is in a group which has all other values filled
                in.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>Settings</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Delay after filling in cells.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">FILL_DELAY</span> <span class="o">=</span> <span class="mi">50</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Delay after finishing a strategy.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">STRAT_DELAY</span> <span class="o">=</span> <span class="mi">100</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Maximum number of iterations to try for solve loop.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">max_solve_iter</span> <span class="o">=</span> <span class="mi">10</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h1>Helper Functions</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Logging</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">log</span> <span class="o">=</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">t</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#stderr&#39;</span><span class="p">)</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="nx">s</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">)</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">(</span><span class="mi">9999999</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">s</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Count the number of elements of an array which are greater than 0.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">num_pos</span> <span class="o">=</span> <span class="p">(</span><span class="nx">xs</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">xs</span><span class="p">,</span> <span class="p">(</span> <span class="p">(</span><span class="nx">memo</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">memo</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">else</span> <span class="nx">memo</span> <span class="p">),</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>Cordinate Manipulation</h2>

<p>There are three coordinate systems: base index, cartesian coordinates, and box
coordinates. These provide functions for converting between any two systems
(there are 6 such possible conversions).</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <pre><code>Base index -&gt; cartesian coordinates
i -&gt; [x, y]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">base_to_cart</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="mi">9</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="mi">9</span><span class="p">)]</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <pre><code>Cartesian coordinates -&gt; base index
x,y -&gt; i
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">cart_to_base</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="mi">9</span><span class="o">*</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <pre><code>Cartesian coordinates -&gt; box coordinates
x,y -&gt; [b_x, b_y, s_x, s_y]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">cart_to_box</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">x</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">y</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">x</span><span class="o">%</span><span class="mi">3</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">y</span><span class="o">%</span><span class="mi">3</span><span class="p">)]</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <pre><code>Box coordinates -&gt; cartesian coordinates
b_x,b_y,s_x,s_y -&gt; [x, y]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">box_to_cart</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="nx">b_x</span> <span class="o">+</span> <span class="nx">s_x</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="nx">b_y</span> <span class="o">+</span> <span class="nx">s_y</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <pre><code>Base index -&gt; box coordinates
i -&gt; [b_x, b_y, s_x, s_y]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">base_to_box</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">cart_to_box</span> <span class="nx">base_to_cart</span><span class="p">(</span><span class="nx">i</span><span class="p">)...</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <pre><code>Box coordinates -&gt; base index
b_x,b_y,s_x,s_y -&gt; i
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">box_to_base</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">cart_to_base</span> <span class="nx">box_to_cart</span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">)...</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>DOM Interaction Functions</h2>

<p>These are functions that mainly use JQuery to interact with the DOM either by
gathering input, setting cell values on the display, or affecting other parts
of the DOM necessary for animation.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dom</span> <span class="o">=</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>JQuery Selectors</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Returns a selector for the cell specified in cartesian coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sel: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cart_to_box</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span>
    <span class="k">return</span> <span class="s2">&quot;.gr#{b_y} .gc#{b_x} .r#{s_y} .c#{s_x}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Returns a selector for all the cells in the same row as the cell specified
in cartesian coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sel_row: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cart_to_box</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span>
    <span class="nx">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="s2">&quot;.gr#{b_y} .gc#{i} .r#{s_y} .c#{j}, &quot;</span> <span class="nx">unless</span> <span class="nx">i</span> <span class="o">==</span> <span class="nx">b_x</span> <span class="o">and</span> <span class="nx">j</span> <span class="o">==</span> <span class="nx">s_x</span>
    <span class="k">return</span> <span class="nx">s</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Returns a selector for all the cells in the same col as the cell specified
in cartesian coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sel_col: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cart_to_box</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span>
    <span class="nx">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="s2">&quot;.gr#{i} .gc#{b_x} .r#{j} .c#{s_x}, &quot;</span> <span class="nx">unless</span> <span class="nx">i</span> <span class="o">==</span> <span class="nx">b_y</span> <span class="o">and</span> <span class="nx">j</span> <span class="o">==</span> <span class="nx">s_y</span>
    <span class="k">return</span> <span class="nx">s</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Returns a selector for all the cells in the same box as the cell specified
in cartesian coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sel_box: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cart_to_box</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span>
    <span class="nx">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="s2">&quot;.gr#{b_y} .gc#{b_x} .r#{j} .c#{i}, &quot;</span> <span class="nx">unless</span> <span class="nx">i</span> <span class="o">==</span> <span class="nx">s_x</span> <span class="o">and</span> <span class="nx">j</span> <span class="o">==</span> <span class="nx">s_y</span>
    <span class="k">return</span> <span class="nx">s</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h3>DOM Accessors</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Get the value in the input HTML element corresponding to the cell specified
in cartesian coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_input_val: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; .num&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3>DOM Mutators</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Set the value in the input HTML element corresponding to the cell specified
in cartesian coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">set_input_val: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; .num&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Assigns hover callbacks to the cell specified in cartesian coordinates which
highlight the cells in the same row, col, and box as the specified cell.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">color_adjacent: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">fn1</span> <span class="o">=</span> <span class="o">=&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel_box</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;adj-box&quot;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel_col</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;adj-col&quot;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel_row</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;adj-row&quot;</span><span class="p">)</span>
    <span class="nx">fn2</span> <span class="o">=</span> <span class="o">=&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel_box</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;adj-box&quot;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel_col</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;adj-col&quot;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel_row</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;adj-row&quot;</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span><span class="nx">hover</span><span class="p">(</span><span class="nx">fn1</span><span class="p">,</span> <span class="nx">fn2</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Assigns hover callbacks to the cell specified in cartesian coordinates which
updates the position label with the cell's coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">display_pos: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">fn</span> <span class="o">=</span> <span class="o">-&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#pos-label&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;(#{x},#{y})&quot;</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="nx">sel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span><span class="nx">hover</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Updates the display with a new strategy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">announce_strategy: </span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#strat&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h1>Grid</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">class</span> <span class="nx">Grid</span>
  <span class="nv">constructor: </span><span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">base_array</span> <span class="o">=</span> <span class="err">@</span><span class="nx">collect_input</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h2>Accesssor Methods</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Access an element from the grid by a base index. Throws an error if an
invalid input is specified.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get: </span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">throw</span> <span class="s2">&quot;Invalid base index&quot;</span> <span class="k">if</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">80</span>
    <span class="err">@</span><span class="nx">base_array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Access an element from the grid using cartesian coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_c: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">get</span> <span class="nx">cart_to_base</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Access an element from the grid using box coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_b: </span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">get</span> <span class="nx">cart_to_base</span> <span class="nx">box_to_cart</span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">)...</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <h2>Mutator Methods</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Set a cell specified by a base index to a value. Also handles animation to
highlight the cell.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">set: </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>store in Grid's internal representation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="err">@</span><span class="nx">base_array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>change value in DOM and highlight if setting to a non-blank space.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">base_to_cart</span> <span class="nx">i</span>
    <span class="k">if</span> <span class="nx">v</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nx">dom</span><span class="p">.</span><span class="nx">set_input_val</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">dom</span><span class="p">.</span><span class="nx">set_input_val</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">dom</span><span class="p">.</span><span class="nx">sel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">dom</span><span class="p">.</span><span class="nx">sel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)).</span>
        <span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">).</span><span class="nx">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Set a cell specified by cartesian coordinates to a value.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">set_c: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">set</span><span class="p">(</span><span class="nx">cart_to_base</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">),</span> <span class="nx">v</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Set a cell specified by box coordinates to a value.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">set_b: </span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">set</span><span class="p">(</span><span class="nx">cart_to_base</span> <span class="nx">box_to_cart</span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">)...,</span> <span class="nx">v</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <h2>Utility Methods</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Collect the inputted cell values from the DOM.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">collect_input: </span><span class="o">-&gt;</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
        <span class="nx">v</span> <span class="o">=</span> <span class="nx">dom</span><span class="p">.</span><span class="nx">get_input_val</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">push</span> <span class="k">if</span> <span class="nx">v</span> <span class="o">is</span> <span class="s1">&#39;&#39;</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Determines if an array of numbers has one of each of the value 1..9 without
any repeats.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">valid_array: </span><span class="p">(</span><span class="nx">xs</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">hits</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">xs</span>
      <span class="k">if</span> <span class="nx">hits</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span><span class="o">?</span> <span class="k">then</span> <span class="nx">hits</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">else</span> <span class="nx">hits</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="nx">hit</span> <span class="k">in</span> <span class="nx">hits</span><span class="p">[</span><span class="mi">1</span><span class="p">...</span><span class="mi">9</span><span class="p">]</span>
      <span class="k">return</span> <span class="kc">false</span> <span class="k">if</span> <span class="nx">hit</span> <span class="o">isnt</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Determine if the grid is solved.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">is_solved: </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
      <span class="k">return</span> <span class="kc">false</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">valid_array</span> <span class="err">@</span><span class="nx">get_col_vals</span> <span class="nx">i</span>
      <span class="k">return</span> <span class="kc">false</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">valid_array</span> <span class="err">@</span><span class="nx">get_row_vals</span> <span class="nx">i</span>
      <span class="k">return</span> <span class="kc">false</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">valid_array</span> <span class="err">@</span><span class="nx">get_box_vals</span> <span class="nx">i</span>
    <span class="k">return</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Return whether base index i is in row r.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">idx_in_row: </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">base_to_cart</span><span class="p">(</span><span class="nx">i</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Return whether base index i is in col c.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">idx_in_col: </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">base_to_cart</span><span class="p">(</span><span class="nx">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Return whether base index i is in box b.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">idx_in_box: </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">base_to_box</span> <span class="nx">i</span>
    <span class="k">return</span> <span class="mi">3</span><span class="o">*</span><span class="nx">b_y</span> <span class="o">+</span> <span class="nx">b_x</span> <span class="o">==</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <h2>Convenient Advanced Accessors</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Returns an array of the indices of the cells in a specified box. The box can
be specified either in cartesian coordinates (of range [0..2]x[0..2]) or
indexed 0-8.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_box_idxs: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">y</span><span class="o">?</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">x</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">x</span><span class="o">%</span><span class="mi">3</span><span class="p">)</span>

    <span class="nx">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">push</span> <span class="nx">box_to_base</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span>
    <span class="k">return</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Returns the array of all the indices of the cells in the box which the
specified cell occupies. The cell can be specified either in cartesian
coordinates or as a base index.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_box_idxs_of: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">y</span><span class="o">?</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="nx">cart_to_base</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span>

    <span class="p">[</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">base_to_box</span> <span class="nx">x</span>
    <span class="err">@</span><span class="nx">get_box_idxs</span> <span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Returns an array of all the values in a specified box. The box can be
specified either in cartesian coordinates (of range [0..2]x[0..2]) or
indexed 0-8.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_box_vals: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">(</span><span class="err">@</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="err">@</span><span class="nx">get_box_idxs</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Returns the array of all the values in the box which the specified cell
occupies. The cell can be specified either in cartesian coordinates or as a
base index.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_box_vals_of: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">(</span><span class="err">@</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="err">@</span><span class="nx">get_box_idxs_of</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Returns an array of all the indices of the cells in a specified col.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_col_idxs: </span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">(</span><span class="nx">cart_to_base</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Returns the array of all indices of the cells in the col which this cell
occupies. The cell can be specified either in cartesian coordinates or as
a base index.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_col_idxs_of: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">y</span><span class="o">?</span>
      <span class="err">@</span><span class="nx">get_col_idxs</span> <span class="nx">x</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">get_col_idxs</span> <span class="nx">base_to_cart</span><span class="p">(</span><span class="nx">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Returns an array of all the values in a specified col.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_col_vals: </span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">(</span><span class="err">@</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="err">@</span><span class="nx">get_col_idxs</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Returns the array of all values in the col which this cell occupies. The
cell can be specified either in cartesian coordinates or as a base index.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_col_vals_of: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">(</span><span class="err">@</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="err">@</span><span class="nx">get_col_idxs_of</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Returns an array of all the indices of the cells in a specified row.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_row_idxs: </span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">(</span><span class="nx">cart_to_base</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Returns the array of all indices of the cells in the row which this cell
occupies. The cell can be specified either in cartesian coordinates or as a
base index.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_row_idxs_of: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">y</span><span class="o">?</span>
      <span class="err">@</span><span class="nx">get_row_idxs</span> <span class="nx">y</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">get_row_idxs</span> <span class="nx">base_to_cart</span><span class="p">(</span><span class="nx">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Returns an array of all the values in a specified row.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_row_vals: </span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">(</span><span class="err">@</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="err">@</span><span class="nx">get_row_idxs</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Returns the array of all values in the row which this cell occupies. The
cell can be specified either in cartesian coordinates or as a base index.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_row_vals_of: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">(</span><span class="err">@</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="err">@</span><span class="nx">get_row_idxs_of</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <h1>---------------------------------------------------------------------------</h1>

<h1>Solver Class --------------------------------------------------------------</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">class</span> <span class="nx">Solver</span>
  <span class="nv">constructor: </span><span class="p">(</span><span class="err">@</span><span class="nx">grid</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>A Solver is constructed once every time the solve button is hit, so all
the relevant parameters are set to their defaults here.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Restrictions are indexed first by cell index and then by value
restricted. So @restrictions[0] is the array of restricted values for cell
0, and @restrictions[10][5] is a 1 if cell 10 is restricted from being value
5 or is a 0 if cell 10 is not restricted from being value 5.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="err">@</span><span class="nx">restrictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">make_empty_restriction</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">restrictions</span> <span class="o">=</span> <span class="p">(</span><span class="nx">make_empty_restriction</span><span class="p">()</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="mi">81</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Clusters are indexed first by type of group (row = 0, col = 1, box = 2),
then by index of that group (0-8), then by value (1-9), then by positions
(0-8), with a 0 indicating not in the cluster and 1 indicating in the
cluster. For example, if @clusters[1][3][2] were [1,1,1,0,0,0,0,0,0], then
the 4th row would need to have value 2 in the first 3 spots.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="err">@</span><span class="nx">clusters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">make_empty_cluster</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">make_empty_cluster_vals</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nx">make_empty_cluster</span><span class="p">()</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">9</span><span class="p">])</span>
    <span class="nx">make_empty_cluster_groups</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nx">make_empty_cluster_vals</span><span class="p">()</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">])</span>
    <span class="err">@</span><span class="nx">clusters</span> <span class="o">=</span> <span class="p">(</span><span class="nx">make_empty_cluster_groups</span><span class="p">()</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">])</span>

    <span class="err">@</span><span class="nx">solve_iter</span> <span class="o">=</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>count the number of occurrences of each value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="err">@</span><span class="nx">occurrences</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">9</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="mi">81</span><span class="p">]</span>
        <span class="err">@</span><span class="nx">occurrences</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">==</span> <span class="nx">v</span>

    <span class="err">@</span><span class="nx">prev_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="err">@</span><span class="nx">updated</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="nv">prev_strats: </span><span class="o">-&gt;</span>
    <span class="nx">strats</span> <span class="o">=</span> <span class="p">(</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">strat</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">length</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>get an array of all naively impossible values to fill into the cell at base
index i in the grid. the impossible values are simply the values filled in
to cells that share a row, col, or box with this cell. if the cell already
has a value, then will return all other values; this seems a little
unnecessary, but turns out to make other things cleaner.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">naive_impossible_values: </span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">([</span><span class="mi">1</span><span class="p">..</span><span class="mi">9</span><span class="p">],</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_row_vals_of</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span>
        <span class="nx">concat</span><span class="p">(</span><span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_col_vals_of</span><span class="p">(</span><span class="nx">i</span><span class="p">)).</span>
          <span class="nx">concat</span><span class="p">(</span><span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_box_vals_of</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>gets a list of positions in a specified box where v can be filled in based
on naive<em>impossible</em>values. the box is specified either as (x,y) in
[0..2]x[0..2] or with a single index in [0..8]. positions are returned as
base indices of the grid.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">naive_possible_positions_in_box: </span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">y</span><span class="o">?</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">x</span> <span class="o">/</span> <span class="mi">3</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">x</span> <span class="o">%</span> <span class="mi">3</span>

    <span class="nx">ps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">b</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="nx">box_to_base</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span>
        <span class="nx">ps</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">v</span> <span class="k">in</span> <span class="err">@</span><span class="nx">naive_impossible_values</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="nx">ps</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>gets a list of positions in a specified row where v can be filled in based
on naive<em>impossible</em>values. the row is specified as a y-coordinate of
cartesian coordinates, and positions are returned as base indices of the grid.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">naive_possible_positions_in_row: </span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">ps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="nx">cart_to_base</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span>
      <span class="nx">ps</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">v</span> <span class="k">in</span> <span class="err">@</span><span class="nx">naive_impossible_values</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="nx">ps</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>gets a list of positions in a specified col where v can be filled in based
on naive<em>impossible</em>values. the row is specified as an x-coordinate of
cartesian coordinates, and positions are returned as base indices of the grid.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">naive_possible_positions_in_col: </span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">ps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="nx">cart_to_base</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span>
      <span class="nx">ps</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">v</span> <span class="k">in</span> <span class="err">@</span><span class="nx">naive_impossible_values</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="nx">ps</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>wrapper for @grid.set which will update the knowledge base.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">set: </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">set</span> <span class="nx">i</span><span class="p">,</span><span class="nx">v</span>

    <span class="err">@</span><span class="nx">occurrences</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="p">[</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">base_to_cart</span> <span class="nx">i</span>
    <span class="p">[</span><span class="nx">b_x</span><span class="p">,</span><span class="nx">b_y</span><span class="p">,</span><span class="nx">s_x</span><span class="p">,</span><span class="nx">s_y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">base_to_box</span> <span class="nx">i</span>

    <span class="nx">fun</span> <span class="o">=</span>  <span class="p">(</span> <span class="o">=&gt;</span>
      <span class="err">@</span><span class="nx">fill_obvious_row</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="err">@</span><span class="nx">fill_obvious_col</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="err">@</span><span class="nx">fill_obvious_box</span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">FILL_DELAY</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>if the specified row only has one value missing, then will fill in that value.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fill_obvious_row: </span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">vals</span> <span class="o">=</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_row_vals</span> <span class="nx">y</span>

    <span class="k">if</span> <span class="nx">num_pos</span><span class="p">(</span><span class="nx">vals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>get the one missing value</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">v</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="nx">v</span> <span class="o">+=</span> <span class="mi">1</span> <span class="nx">until</span> <span class="nx">v</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">vals</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>get the position missing it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span> <span class="nx">until</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_c</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

      <span class="nx">log</span> <span class="s2">&quot;Setting (#{x},#{y}) to #{v} because it&#39;s row-obvious&quot;</span>
      <span class="err">@</span><span class="nx">set_c</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">v</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">callback</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>if the specified col only has one value missing, then will fill in that
value.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fill_obvious_col: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">vals</span> <span class="o">=</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_col_vals</span> <span class="nx">x</span>

    <span class="k">if</span> <span class="nx">num_pos</span><span class="p">(</span><span class="nx">vals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>get the one missing value</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">v</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="nx">v</span> <span class="o">+=</span> <span class="mi">1</span> <span class="nx">until</span> <span class="nx">v</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">vals</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>get the position missing it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span> <span class="nx">until</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_c</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

      <span class="nx">log</span> <span class="s2">&quot;Setting (#{x},#{y}) to #{v} becasue it&#39;s col-obvious&quot;</span>
      <span class="err">@</span><span class="nx">set_c</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">v</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">callback</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>if the specified box only has one value missing, then will fill in that
value.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fill_obvious_box: </span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">b_y</span><span class="o">?</span>
      <span class="nx">b</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="nx">b_y</span> <span class="o">+</span> <span class="nx">b_x</span>
    <span class="k">else</span>
      <span class="nx">b</span> <span class="o">=</span> <span class="nx">b_x</span>
      <span class="nx">b_x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">b_x</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span>
      <span class="nx">b_y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">b_y</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

    <span class="nx">vals</span> <span class="o">=</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_box_vals</span> <span class="nx">b</span>

    <span class="k">if</span> <span class="nx">num_pos</span><span class="p">(</span><span class="nx">vals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>get the one missing value</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">v</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="nx">v</span> <span class="o">+=</span> <span class="mi">1</span> <span class="nx">until</span> <span class="nx">v</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">vals</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>get the list of indices in the box.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">box_idxs</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">2</span><span class="p">]</span>
          <span class="nx">box_idxs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">box_to_base</span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">j</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>get the position missing it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="nx">until</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">box_idxs</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>

      <span class="nx">log</span> <span class="s2">&quot;Setting (#{base_to_cart(box_idxs[i])}) to #{v} because it&#39;s&quot;</span> <span class="o">+</span>
      <span class="s2">&quot; box-obvious&quot;</span>
      <span class="err">@</span><span class="nx">set</span><span class="p">(</span><span class="nx">box_idxs</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">callback</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>wrapper for @grid.set_c which will update the knowledge base if it needs to.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">set_c: </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">v</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">set</span><span class="p">(</span><span class="nx">cart_to_base</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">),</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>wrapper for @grid.set_b which will update the knowldege base if it needs to.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">set_b: </span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">set</span><span class="p">(</span><span class="nx">cart_to_base</span> <span class="nx">box_to_cart</span><span class="p">(</span><span class="nx">b_x</span><span class="p">,</span> <span class="nx">b_y</span><span class="p">,</span> <span class="nx">s_x</span><span class="p">,</span> <span class="nx">s_y</span><span class="p">)...,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>adds a restriction of value v to cell with base index i. returns whether the
restriction was useful information (ie, if the restriction wasn't already in
the database of restrictions)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add_restriction: </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>we should only be adding restrictions to cells which aren't set yet.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">throw</span> <span class="s2">&quot;Error&quot;</span> <span class="k">if</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="nx">prev</span> <span class="o">=</span> <span class="err">@</span><span class="nx">restrictions</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">v</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">restrictions</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">prev</span> <span class="o">==</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>gets a representation of the cell restriction for the cell with base index
i. if the cell has a lot of restrictions, then returns a list of values
which the cell must be; if the cell has only a few restrictions, then
returns a list of values which the cell can't be. the returned object will
have a "type" field specifying if it's returning the list of cells possible
("must"), the list of cells not possible ("cant"), or no information because
no info has yet been storetd for the cell ("none"), and a "vals" array with
the list of values either possible or impossle.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_restrictions: </span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="err">@</span><span class="nx">restrictions</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="nx">num_pos</span> <span class="nx">r</span>

    <span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="p">{</span> <span class="nv">type: </span><span class="s2">&quot;none&quot;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">n</span> <span class="o">&lt;=</span> <span class="mi">4</span>
      <span class="nx">cants</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">9</span><span class="p">]</span>
        <span class="nx">cants</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="k">if</span> <span class="nx">r</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
      <span class="k">return</span> <span class="p">{</span> <span class="nv">type: </span><span class="s2">&quot;cant&quot;</span><span class="p">,</span> <span class="nv">vals: </span><span class="nx">cants</span> <span class="p">}</span>
    <span class="k">else</span> <span class="c1"># this will mean n &gt;= 5</span>
      <span class="nx">musts</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">9</span><span class="p">]</span>
        <span class="nx">musts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="k">if</span> <span class="nx">r</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="p">{</span> <span class="nv">type: </span><span class="s2">&quot;must&quot;</span><span class="p">,</span> <span class="nv">vals: </span><span class="nx">musts</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>returns an array of values in order of the number of their occurrences,
in order of most prevalent to least prevalent. only includes values which
occur 5 or more times.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">vals_by_occurrences_above_4: </span><span class="o">-&gt;</span>
    <span class="nx">ord</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="p">[</span><span class="mi">9</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">9</span><span class="p">]</span>
        <span class="nx">ord</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="k">if</span> <span class="err">@</span><span class="nx">occurrences</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">==</span> <span class="nx">o</span>
    <span class="k">return</span> <span class="nx">ord</span>

  <span class="nv">vals_by_occurrences: </span><span class="o">-&gt;</span>
    <span class="nx">ord</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="p">[</span><span class="mi">9</span><span class="p">..</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">9</span><span class="p">]</span>
        <span class="nx">ord</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="k">if</span> <span class="err">@</span><span class="nx">occurrences</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">==</span> <span class="nx">o</span>
    <span class="k">return</span> <span class="nx">ord</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>if the base indices are all in the same row, then returns that row;
otherwise returns false.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">same_row: </span><span class="p">(</span><span class="nx">idxs</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">first_row</span> <span class="o">=</span> <span class="nx">base_to_cart</span><span class="p">(</span><span class="nx">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nx">idxs</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">idxs</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="nx">idxs</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>return false if one of the rows doesn't match the first.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="kc">false</span> <span class="k">if</span> <span class="nx">base_to_cart</span><span class="p">(</span><span class="nx">idx</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">first_row</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>return true if they all match the first.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">first_row</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>if the base indices are all in the same column, then returns that col;
otherwise returns false.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">same_col: </span><span class="p">(</span><span class="nx">idxs</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">first_col</span> <span class="o">=</span> <span class="nx">base_to_cart</span><span class="p">(</span><span class="nx">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">idxs</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">idxs</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="nx">idxs</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>return false if one of the cols doesn't match the first.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="kc">false</span> <span class="k">if</span> <span class="nx">base_to_cart</span><span class="p">(</span><span class="nx">idx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">first_col</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>return true if they all match the first</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">first_col</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>if the base indices are all in the same box, then returns that box;
otherwise returns false.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">same_box: </span><span class="p">(</span><span class="nx">idxs</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">first_box</span> <span class="o">=</span> <span class="nx">base_to_box</span><span class="p">(</span><span class="nx">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nx">idxs</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">idxs</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="nx">idxs</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>return false if one of the boxes doesn't match the first.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">box</span> <span class="o">=</span> <span class="nx">base_to_box</span><span class="p">(</span><span class="nx">idx</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">false</span> <span class="k">if</span> <span class="nx">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">first_box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">or</span> <span class="nx">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">first_box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>return true if they all match the first</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">first_box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nx">first_box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>STRATEGIES -----------------------------------------------------------------</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <h2>GridScan -------------------------------------------------------------------</h2>

<p>--- Consider each value that occurs 5 or more times, in order of currently -
--- most present on the grid to least present. For each value v, consider --</p>

<h2>--- the boxes b where v has not yet been filled in. ------------------------</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Get the list of values in order of their occurrences, and start the main
value loop.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">GridScan: </span><span class="o">-&gt;</span>
    <span class="nx">log</span> <span class="s2">&quot;Trying GridScan&quot;</span>

    <span class="err">@</span><span class="nx">updated</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="nx">vals</span> <span class="o">=</span> <span class="err">@</span><span class="nx">vals_by_occurrences_above_4</span><span class="p">()</span>

    <span class="k">if</span> <span class="nx">vals</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="err">@</span><span class="nx">GridScanValLoop</span><span class="p">(</span><span class="nx">vals</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">success</span> <span class="o">=</span> <span class="err">@</span><span class="nx">updated</span>
      <span class="nx">setTimeout</span><span class="p">((</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">solve_loop</span><span class="p">()),</span> <span class="nx">STRAT_DELAY</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>For a specified value, get the boxes where that value has not yet been
filled in. If there such boxes, then begin a box loop in the first of the
boxes; if there are no such boxes, then either go to the next value or
finish the strategy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">GridScanValLoop: </span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">v</span> <span class="o">=</span> <span class="nx">vs</span><span class="p">[</span><span class="nx">vi</span><span class="p">]</span>

    <span class="nx">boxes</span> <span class="o">=</span> <span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>get the boxes which don't contain v, which are the only ones we're
considering for the strategy</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">b</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
      <span class="nx">boxes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="k">if</span> <span class="nx">v</span> <span class="o">not</span> <span class="k">in</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_box_vals</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">boxes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>if there are possible boxes, then start iterating on them.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="err">@</span><span class="nx">GridScanBoxLoop</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="p">,</span> <span class="nx">boxes</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">vi</span> <span class="o">&lt;</span> <span class="nx">vs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>if there are no possible boxes and there are more values, move to the
next value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="err">@</span><span class="nx">GridScanValLoop</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>if there are no possible boxes and there are no more values, then move
to the next strategy</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">success</span> <span class="o">=</span> <span class="err">@</span><span class="nx">updated</span>
        <span class="nx">setTimeout</span><span class="p">((</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">solve_loop</span><span class="p">()),</span> <span class="nx">STRAT_DELAY</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>For a specified value and box, see where the value is possible in the
box. If the value is only possible in one position, then fill it in. Move
on to the next box if there are more boxes; move on to the next value if
there are no more boxes and there are more values; move on to the next
strategy if there are n omroe boxes or values.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">GridScanBoxLoop: </span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="p">,</span> <span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">v</span> <span class="o">=</span> <span class="nx">vs</span><span class="p">[</span><span class="nx">vi</span><span class="p">]</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">bs</span><span class="p">[</span><span class="nx">bi</span><span class="p">]</span>

    <span class="nx">ps</span> <span class="o">=</span> <span class="err">@</span><span class="nx">naive_possible_positions_in_box</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">b</span>

    <span class="nx">next_box</span> <span class="o">=</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">GridScanBoxLoop</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="p">,</span> <span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="nx">next_val</span> <span class="o">=</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">GridScanValLoop</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="nx">next_strat</span> <span class="o">=</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">solve_loop</span><span class="p">()</span> <span class="p">)</span>

    <span class="k">if</span> <span class="nx">bi</span> <span class="o">&lt;</span> <span class="nx">bs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>go to the next box if there are more boxes.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">next_box</span>
      <span class="nx">delay</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">vi</span> <span class="o">&lt;</span> <span class="nx">vs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>go to the next value if there are no more boxes, but more values.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">next_val</span>
      <span class="nx">delay</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>go to the next strategy if there are no more values or boxes.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">next_strat</span>
      <span class="nx">delay</span> <span class="o">=</span> <span class="nx">STRAT_DELAY</span>

    <span class="k">if</span> <span class="nx">ps</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span>
      <span class="nx">log</span> <span class="s2">&quot;Setting (#{base_to_cart ps[0]}) to #{v} by GridScan&quot;</span>
      <span class="err">@</span><span class="nx">set</span><span class="p">(</span><span class="nx">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">v</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="err">@</span><span class="nx">updated</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="nx">delay</span> <span class="o">+=</span> <span class="nx">FILL_DELAY</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">delay</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">callback</span> <span class="o">==</span> <span class="nx">next_strat</span>
        <span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">success</span> <span class="o">=</span> <span class="err">@</span><span class="nx">updated</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span>

  <span class="nv">should_gridscan: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>for now, will only run gridscan if the last operation was gridscan and it
worked. this reflects how I use it mainly in the beginning of a puzzle.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">true</span> <span class="k">if</span> <span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="nx">last_result</span> <span class="o">=</span> <span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="nx">last_result</span><span class="p">.</span><span class="nx">strat</span> <span class="o">==</span> <span class="s2">&quot;GridScan&quot;</span> <span class="o">and</span> <span class="nx">last_result</span><span class="p">.</span><span class="nx">success</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <h2>SmartGridScan --------------------------------------------------------------</h2>

<p>--- Consider each value, in order of currently most present on the grid to -
--- least present. For each value v, consider each box b where v has not ---
--- yet been filled in. Let p be the set of positions where v can be -------
--- placed within b. If p is a single position, then fill in v at this -----
--- position (note that this is extremely similar to GridScan in this ------
--- case). If all the positions in p are in a single row or col, then add --
--- a restriction of v to all other cells in the row or col but outside of -
--- b. NOTE: This is entirely a knowledge refinement strategy (except in ---
--- the case where it is exactly GridScan), because adding a restriction ---</p>

<h2>--- won't affect anything until ExhaustionSearch is run. -------------------</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Get the list of values in order of their occurrences, and start the main
value loop.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">SmartGridScan: </span><span class="o">-&gt;</span>
    <span class="nx">log</span> <span class="s2">&quot;Trying SmartGridScan&quot;</span>

    <span class="err">@</span><span class="nx">updated</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="nx">vals</span> <span class="o">=</span> <span class="err">@</span><span class="nx">vals_by_occurrences</span><span class="p">()</span>

    <span class="err">@</span><span class="nx">SmartGridValLoop</span><span class="p">(</span><span class="nx">vals</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>For a specified value, get the boxes where that value has not yet been
filled in. If there are such boxes, then begin a box loop in the frsit of
the boxes; if there are no such boxes, then either go to the next value or
finish the strategy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">SmartGridValLoop: </span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">v</span> <span class="o">=</span> <span class="nx">vs</span><span class="p">[</span><span class="nx">vi</span><span class="p">]</span>

    <span class="nx">boxes</span> <span class="o">=</span> <span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>get the boxes which don't contain v, which are the only ones we're
considering for this startegy.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">b</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
      <span class="nx">boxes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="k">if</span> <span class="nx">v</span> <span class="o">not</span> <span class="k">in</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_box_vals</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">boxes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>if there are possible boxes, then start iterating on them.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="err">@</span><span class="nx">SmartGridBoxLoop</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="p">,</span> <span class="nx">boxes</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">vi</span> <span class="o">&lt;</span> <span class="nx">vs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>if there are no possible boxes and there are more values, move to the
next value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="err">@</span><span class="nx">SmartGridValLoop</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>if there are no possible boxes and there are no more values, then move
to the next strategy.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">success</span> <span class="o">=</span> <span class="err">@</span><span class="nx">updated</span>
        <span class="nx">setTimeout</span><span class="p">((</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">solve_loop</span><span class="p">()),</span> <span class="nx">STRAT_DELAY</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>For a specified value and box, see where the values is possible in the
box. If the value is only possible in one position, then fill it in (like
normal GridScan). If it's possible in two or three positions, and those
positions happen to be in the same rows or cols, then will add restrictions
to all the other cells in the same row/col outside the box. Move on to the
next box if there are more boxes; move on to the next value if there are no
more boxes and there are more values; move on to the next strategy if there
are no more boxes or values.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">SmartGridBoxLoop: </span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="p">,</span> <span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">v</span> <span class="o">=</span> <span class="nx">vs</span><span class="p">[</span><span class="nx">vi</span><span class="p">]</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">bs</span><span class="p">[</span><span class="nx">bi</span><span class="p">]</span>

    <span class="nx">ps</span> <span class="o">=</span> <span class="err">@</span><span class="nx">naive_possible_positions_in_box</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">b</span>

    <span class="nx">next_box</span> <span class="o">=</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">SmartGridBoxLoop</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="p">,</span> <span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="nx">next_val</span> <span class="o">=</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">SmartGridValLoop</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="nx">next_strat</span> <span class="o">=</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">solve_loop</span><span class="p">()</span> <span class="p">)</span>

    <span class="k">if</span> <span class="nx">bi</span> <span class="o">&lt;</span> <span class="nx">bs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>go to the next box if there are more boxes.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">next_box</span>
      <span class="nx">delay</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">vi</span> <span class="o">&lt;</span> <span class="nx">vs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>go to the next value if there are no more boxes, but more values.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">next_val</span>
      <span class="nx">delay</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>go to the next strategy if there are no more values or boxes.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">next_strat</span>
      <span class="nx">delay</span> <span class="o">=</span> <span class="nx">STRAT_DELAY</span>

    <span class="k">switch</span> <span class="nx">ps</span><span class="p">.</span><span class="nx">length</span>
      <span class="k">when</span> <span class="mi">1</span>
        <span class="nx">log</span> <span class="s2">&quot;Setting (#{base_to_cart ps[0]}) to #{v} by SmartGridScan&quot;</span>
        <span class="err">@</span><span class="nx">set</span><span class="p">(</span><span class="nx">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">v</span><span class="p">,</span> <span class="o">=&gt;</span>
          <span class="err">@</span><span class="nx">updated</span> <span class="o">=</span> <span class="kc">true</span>
          <span class="nx">delay</span> <span class="o">+=</span> <span class="nx">FILL_DELAY</span><span class="p">)</span>
      <span class="k">when</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
        <span class="nx">just_updated</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="k">if</span> <span class="err">@</span><span class="nx">same_row</span><span class="p">(</span><span class="nx">ps</span><span class="p">)</span>
          <span class="nx">y</span> <span class="o">=</span> <span class="err">@</span><span class="nx">same_row</span><span class="p">(</span><span class="nx">ps</span><span class="p">)</span>
          <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="nx">cart_to_base</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span>
            <span class="nx">unless</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">idx_in_box</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span> <span class="o">or</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
              <span class="nx">just_updated</span> <span class="o">=</span> <span class="err">@</span><span class="nx">add_restriction</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span>
        <span class="k">else</span> <span class="k">if</span> <span class="err">@</span><span class="nx">same_col</span><span class="p">(</span><span class="nx">ps</span><span class="p">)</span>
          <span class="nx">x</span> <span class="o">=</span> <span class="err">@</span><span class="nx">same_col</span><span class="p">(</span><span class="nx">ps</span><span class="p">)</span>
          <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="nx">cart_to_base</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span>
            <span class="nx">unless</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">idx_in_box</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span> <span class="o">or</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
              <span class="nx">just_updated</span> <span class="o">=</span> <span class="err">@</span><span class="nx">add_restriction</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span>
        <span class="nx">log</span> <span class="s2">&quot;Refining knowldege base using SmartGridScan&quot;</span> <span class="k">if</span> <span class="nx">just_updated</span>
        <span class="err">@</span><span class="nx">updated</span> <span class="o">||=</span> <span class="nx">just_updated</span>

    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span>

  <span class="nv">should_smartgridscan: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>Should do a smart gridscan if the last attempt at gridscan failed. this
should work because gridscan is always run first, so there should always
be previous strategies with gridscan among them.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">last_gridscan</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">,</span> <span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">last_gridscan</span> <span class="o">=</span> <span class="nx">i</span> <span class="k">if</span> <span class="nx">result</span><span class="p">.</span><span class="nx">strat</span> <span class="o">==</span> <span class="s2">&quot;GridScan&quot;</span> <span class="p">)</span>
    <span class="k">return</span> <span class="o">not</span> <span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="nx">last_gridscan</span><span class="p">].</span><span class="nx">success</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <h2>ThinkInsideTheBox ----------------------------------------------------------</h2>

<p>--- For each box b and for each value v which has not yet been filled in ---
--- within b, see where v could possibly be placed within b (consulting ----
--- the values in corresponding rows/cols and any cant/must arrays filled --
--- in within b); if v can only be placed in one position in b, then -------</p>

<h2>--- fill it in. ------------------------------------------------------------</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>Get a list of boxes and begin the main loop through the box list.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ThinkInsideTheBox: </span><span class="o">-&gt;</span>
    <span class="nx">log</span> <span class="s2">&quot;Trying ThinkInsideTheBox&quot;</span>

    <span class="err">@</span><span class="nx">updated</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="nx">boxes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">ThinkInsideBoxLoop</span><span class="p">(</span><span class="nx">boxes</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>Get the list of values which have not yet been filled in within the current
box, and begin a loop through those values.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ThinkInsideBoxLoop: </span><span class="p">(</span><span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">filled</span> <span class="o">=</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">get_box_vals</span> <span class="nx">bs</span><span class="p">[</span><span class="nx">bi</span><span class="p">]</span>
    <span class="nx">vals</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">([</span><span class="mi">1</span><span class="p">..</span><span class="mi">9</span><span class="p">],</span> <span class="nx">filled</span><span class="p">...)</span>

    <span class="k">if</span> <span class="nx">vals</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>if there are unfilled values, then start iterating on them</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="err">@</span><span class="nx">ThinkInsideValLoop</span><span class="p">(</span><span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="p">,</span> <span class="nx">vals</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">bi</span> <span class="o">&lt;</span> <span class="nx">bs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>if there are no unfilled values and there are more boxes to consider,
then move on to the next box.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="err">@</span><span class="nx">ThinkInsideBoxLoop</span><span class="p">(</span><span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>if there are no unfilled values and there are no more boxes to
consider, then go to the next strategy.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">success</span> <span class="o">=</span> <span class="err">@</span><span class="nx">updated</span>
        <span class="nx">setTimeout</span><span class="p">((</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">solve_loop</span><span class="p">()),</span> <span class="nx">STRAT_DELAY</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>See where the current value can be placed within the current box. If the
value is only possible in one position, then fill it in. Move on to the next
value if there are more values; move on to the next box if thre are no more
values and there are more boxes; move on to the next strategy if there are
no more values or boxes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ThinkInsideValLoop: </span><span class="p">(</span><span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="p">,</span> <span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">v</span> <span class="o">=</span> <span class="nx">vs</span><span class="p">[</span><span class="nx">vi</span><span class="p">]</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">bs</span><span class="p">[</span><span class="nx">bi</span><span class="p">]</span>

    <span class="nx">ps</span> <span class="o">=</span> <span class="err">@</span><span class="nx">naive_possible_positions_in_box</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">b</span>

    <span class="nx">next_val</span> <span class="o">=</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">ThinkInsideValLoop</span><span class="p">(</span><span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="p">,</span> <span class="nx">vs</span><span class="p">,</span> <span class="nx">vi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="nx">next_box</span> <span class="o">=</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">ThinkInsideBoxLoop</span><span class="p">(</span><span class="nx">bs</span><span class="p">,</span> <span class="nx">bi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="nx">next_strat</span> <span class="o">=</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">solve_loop</span><span class="p">()</span> <span class="p">)</span>

    <span class="k">if</span> <span class="nx">vi</span> <span class="o">&lt;</span> <span class="nx">vs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>go to the next value if there are more values.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">next_val</span>
      <span class="nx">delay</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">bi</span> <span class="o">&lt;</span> <span class="nx">bs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>go to the next box if there are no more values, but more boxes.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">next_box</span>
      <span class="nx">delay</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>go to the next strategy if there are no more boxes or values.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">next_strat</span>
      <span class="nx">delay</span> <span class="o">=</span> <span class="nx">STRAT_DELAY</span>

    <span class="k">if</span> <span class="nx">ps</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span>
      <span class="nx">log</span> <span class="s2">&quot;Setting (#{base_to_cart ps[0]}) to #{v} by ThinkInsideTheBox&quot;</span>
      <span class="err">@</span><span class="nx">set</span><span class="p">(</span><span class="nx">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">v</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="err">@</span><span class="nx">updated</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="nx">delay</span> <span class="o">+=</span> <span class="nx">FILL_DELAY</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">delay</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">callback</span> <span class="o">==</span> <span class="nx">next_strat</span>
        <span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">success</span> <span class="o">=</span> <span class="err">@</span><span class="nx">updated</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span>

  <span class="nv">should_thinkinsidethebox: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>do ThinkInsideTheBox unless the last attempt at ThinkInsideTheBox failed.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">last_thinkinside</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="err">@</span><span class="nx">prev_results</span><span class="p">,</span> <span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">last_thinkinside</span> <span class="o">=</span> <span class="nx">i</span> <span class="k">if</span> <span class="nx">result</span><span class="p">.</span><span class="nx">strat</span> <span class="o">==</span> <span class="s2">&quot;ThinkInsideTheBox&quot;</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nx">last_thinkinside</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">or</span> <span class="err">@</span><span class="nx">prev_results</span><span class="p">[</span><span class="nx">last_thinkinside</span><span class="p">].</span><span class="nx">success</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>SOLVE LOOP ---------------------------------------------------------------</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">choose_strategy: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">should_gridscan</span><span class="p">()</span>
      <span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">push</span> <span class="p">{</span><span class="nv">strat: </span><span class="s2">&quot;GridScan&quot;</span><span class="p">}</span>
      <span class="nx">dom</span><span class="p">.</span><span class="nx">announce_strategy</span> <span class="s2">&quot;GridScan&quot;</span>
      <span class="k">return</span> <span class="err">@</span><span class="nx">GridScan</span><span class="p">()</span>

    <span class="k">if</span> <span class="err">@</span><span class="nx">should_thinkinsidethebox</span><span class="p">()</span>
      <span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">push</span> <span class="p">{</span><span class="nv">strat: </span><span class="s2">&quot;ThinkInsideTheBox&quot;</span><span class="p">}</span>
      <span class="nx">dom</span><span class="p">.</span><span class="nx">announce_strategy</span> <span class="s2">&quot;ThinkInside&lt;br /&gt;TheBox&quot;</span>
      <span class="k">return</span> <span class="err">@</span><span class="nx">ThinkInsideTheBox</span><span class="p">()</span>

    <span class="k">if</span> <span class="err">@</span><span class="nx">should_smartgridscan</span><span class="p">()</span>
      <span class="err">@</span><span class="nx">prev_results</span><span class="p">.</span><span class="nx">push</span> <span class="p">{</span><span class="nv">strat: </span><span class="s2">&quot;SmartGridSCan&quot;</span><span class="p">}</span>
      <span class="nx">dom</span><span class="p">.</span><span class="nx">announce_strategy</span> <span class="s2">&quot;SmartGridScan&quot;</span>
      <span class="k">return</span> <span class="err">@</span><span class="nx">SmartGridScan</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>FIXME</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>if @should_thinkoutsidethebox()
  return @ThinkOutsideTheBox()</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>if @should_exhaustionsearch()
  return @ExhaustionSearch()</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>if @should_desperationsearch()
  return @DesperationSearch()</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">solve_loop: </span><span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">solve_iter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">log</span> <span class="s2">&quot;iteration #{@solve_iter}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>done if the grid is complete or we've done too many iterations</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">done</span> <span class="o">=</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">is_solved</span><span class="p">()</span> <span class="o">or</span> <span class="err">@</span><span class="nx">solve_iter</span> <span class="o">&gt;</span> <span class="nx">max_solve_iter</span>

    <span class="nx">log</span> <span class="s2">&quot;tested if done&quot;</span>

    <span class="k">if</span> <span class="nx">done</span>
      <span class="err">@</span><span class="nx">solve_loop_done</span><span class="p">()</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>fill obvious cells and then choose a strategy once complete</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="err">@</span><span class="nx">choose_strategy</span><span class="p">()</span>


  <span class="nv">solve_loop_done: </span><span class="o">-&gt;</span>
    <span class="nx">log</span> <span class="k">if</span> <span class="err">@</span><span class="nx">grid</span><span class="p">.</span><span class="nx">is_solved</span><span class="p">()</span> <span class="k">then</span> <span class="s2">&quot;Grid solved! :)&quot;</span> <span class="k">else</span> <span class="s2">&quot;Grid not solved :(&quot;</span>

    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#strat&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">(</span><span class="o">`</span><span class="p">{</span><span class="nv">opacity: </span><span class="mf">0.0</span><span class="p">,</span> <span class="nv">top: </span><span class="s1">&#39;+=75px&#39;</span><span class="p">}</span><span class="o">`</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;easeOutQuad&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#solve-b&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">(</span><span class="o">`</span><span class="p">{</span><span class="nv">opacity: </span><span class="mf">1.0</span><span class="p">,</span> <span class="nv">top: </span><span class="s1">&#39;-=50px&#39;</span><span class="p">}</span><span class="o">`</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;easeInQuad&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#solve-b, #input-b, input.num&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)))</span>

  <span class="nv">solve: </span><span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">solve_loop</span><span class="p">()</span>


<span class="nx">easy</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">3784.9...</span>
<span class="s1">2....14.9</span>
<span class="s1">1.9.5.3..</span>
<span class="s1">71....25.</span>
<span class="s1">....7....</span>
<span class="s1">.92....84</span>
<span class="s1">..4.2.8.3</span>
<span class="s1">5.71....2</span>
<span class="s1">...9.6547</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="nx">hard</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">4...8.3..</span>
<span class="s1">.7..63..5</span>
<span class="s1">.......46</span>
<span class="s1">.6.357...</span>
<span class="s1">.8.....3.</span>
<span class="s1">...648.2.</span>
<span class="s1">14.......</span>
<span class="s1">7..93..6.</span>
<span class="s1">..2.7...8</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="nx">evil</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">..1...39.</span>
<span class="s1">.....1.8.</span>
<span class="s1">76..4..2.</span>
<span class="s1">....98...</span>
<span class="s1">3...2...8</span>
<span class="s1">...57....</span>
<span class="s1">.1..3..54</span>
<span class="s1">.2.9.....</span>
<span class="s1">.83...6..</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span> <span class="o">-&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#strat&quot;</span><span class="p">).</span><span class="nx">fadeTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="nx">log</span> <span class="s1">&#39;init webapp&#39;</span>

  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">mousemove</span><span class="p">(</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#pos-label&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#pos-label&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="nx">display_pos</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#pos-label&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span>
  <span class="nx">hide_pos</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#pos-label&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>

  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#grid&quot;</span><span class="p">).</span><span class="nx">hover</span><span class="p">(</span><span class="nx">display_pos</span><span class="p">,</span> <span class="nx">hide_pos</span><span class="p">)</span>

  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#stdin&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">easy</span><span class="p">)</span>

  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#puzzle-select&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span> <span class="o">-&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#stdin&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#puzzle-select&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">())))</span>

  <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">8</span><span class="p">]</span>
      <span class="nx">dom</span><span class="p">.</span><span class="nx">color_adjacent</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span>
      <span class="nx">dom</span><span class="p">.</span><span class="nx">display_pos</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span>


  <span class="nx">inject</span> <span class="o">=</span> <span class="o">-&gt;</span>
    <span class="nx">text</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#stdin&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>

    <span class="nx">rows</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="nx">row</span> <span class="k">in</span> <span class="nx">rows</span>

      <span class="nx">cols</span> <span class="o">=</span> <span class="nx">row</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="nx">cols</span>
        <span class="k">if</span> <span class="nx">v</span> <span class="o">is</span> <span class="s1">&#39;.&#39;</span>
          <span class="nx">dom</span><span class="p">.</span><span class="nx">set_input_val</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="nx">dom</span><span class="p">.</span><span class="nx">set_input_val</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span>
        <span class="nx">c</span> <span class="o">+=</span> <span class="mi">1</span>

      <span class="nx">r</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nx">log</span> <span class="s1">&#39;injecting input into the grid&#39;</span>

  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#input-b&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="nx">inject</span>
  <span class="nx">inject</span><span class="p">()</span>


  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#solve-b&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#solve-b, #input-b, input.num&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#solve-b&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">(</span><span class="o">`</span><span class="p">{</span><span class="nv">opacity: </span><span class="mf">0.0</span><span class="p">,</span> <span class="nv">top: </span><span class="s1">&#39;+=50px&#39;</span><span class="p">}</span><span class="o">`</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="s1">&#39;easeOutQuad&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#strat&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">(</span><span class="o">`</span><span class="p">{</span><span class="nv">opacity: </span><span class="mf">1.0</span><span class="p">,</span> <span class="nv">top: </span><span class="s1">&#39;-75px&#39;</span><span class="p">}</span><span class="o">`</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="s1">&#39;easeInQuad&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>

        <span class="nx">log</span> <span class="s2">&quot;Creating a grid object&quot;</span>
        <span class="nx">g</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Grid</span><span class="p">()</span>

        <span class="nx">log</span> <span class="s2">&quot;Creating a solver object&quot;</span>
        <span class="nx">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Solver</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span>

        <span class="nx">log</span> <span class="s2">&quot;Solving...&quot;</span>
        <span class="nx">s</span><span class="p">.</span><span class="nx">solve</span><span class="p">()</span>
      <span class="p">))</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 